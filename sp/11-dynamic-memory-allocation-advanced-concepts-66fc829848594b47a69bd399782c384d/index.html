<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="turbo-root" content="/tech">
    <meta name="turbo-cache-control" content="no-cache" data-turbo-track="reload" data-track-token="2.4.0.712994009815">

    <!-- See retype.com -->
    <meta name="generator" content="Retype 2.4.0">

    <!-- Primary Meta Tags -->
    <title>11. Dynamic Memory Allocation: Advanced Concepts</title>
    <meta name="title" content="11. Dynamic Memory Allocation: Advanced Concepts">
    <meta name="description" content="Dynamic Memory Allocation: Advanced Concepts CSE4100: System Programming Youngjae Kim (PhD)" />

    <!-- Canonical -->
    <link rel="canonical" href="/tech/sp/11-dynamic-memory-allocation-advanced-concepts-66fc829848594b47a69bd399782c384d/" />

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="/tech/sp/11-dynamic-memory-allocation-advanced-concepts-66fc829848594b47a69bd399782c384d/">
    <meta property="og:title" content="11. Dynamic Memory Allocation: Advanced Concepts">
    <meta property="og:description" content="Dynamic Memory Allocation: Advanced Concepts CSE4100: System Programming Youngjae Kim (PhD)">
    <meta property="og:image" content="/tech/sp/11/untitled.png">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="/tech/sp/11-dynamic-memory-allocation-advanced-concepts-66fc829848594b47a69bd399782c384d/">
    <meta property="twitter:title" content="11. Dynamic Memory Allocation: Advanced Concepts">
    <meta property="twitter:description" content="Dynamic Memory Allocation: Advanced Concepts CSE4100: System Programming Youngjae Kim (PhD)">
    <meta property="twitter:image" content="/tech/sp/11/untitled.png">

    <script>(function () { var el = document.documentElement, m = localStorage.getItem("/tech/doc_theme"), wm = window.matchMedia; if (m === "dark" || (!m && wm && wm("(prefers-color-scheme: dark)").matches)) { el.classList.add("dark") } else { el.classList.remove("dark") } })();</script>

    <link href="../../favicon.ico" rel="icon" />
    <link href="../../resources/css/retype.css?v=2.4.0.712994009815" rel="stylesheet" />

    <script type="text/javascript" src="../../resources/js/config.js?v=2.4.0.712994009815" data-turbo-eval="false" defer></script>
    <script type="text/javascript" src="../../resources/js/retype.js?v=2.4.0" data-turbo-eval="false" defer></script>
    <script id="lunr-js" type="text/javascript" src="../../resources/js/lunr.js?v=2.4.0.712994009815" data-turbo-eval="false" defer></script>
    <script id="prism-js" type="text/javascript" src="../../resources/js/prism.js?v=2.4.0.712994009815" defer></script>
</head>
<body>
    <div id="docs-app" class="relative text-base antialiased text-gray-700 bg-white font-body dark:bg-dark-850 dark:text-dark-300">
        <div class="absolute bottom-0 left-0 bg-gray-100 dark:bg-dark-800" style="top: 5rem; right: 50%"></div>
    
        <header id="docs-site-header" class="sticky top-0 z-30 flex w-full h-16 bg-white border-b border-gray-200 md:h-20 dark:bg-dark-850 dark:border-dark-650">
            <div class="container relative flex items-center justify-between grow pr-6 md:justify-start">
                <!-- Mobile menu button skeleton -->
                <button v-cloak class="skeleton docs-mobile-menu-button flex items-center justify-center shrink-0 overflow-hidden dark:text-white focus:outline-none rounded-full w-10 h-10 ml-3.5 md:hidden"><svg xmlns="http://www.w3.org/2000/svg" class="mb-px shrink-0" width="24" height="24" viewBox="0 0 24 24" role="presentation" style="margin-bottom: 0px;"><g fill="currentColor"><path d="M2 4h20v2H2zM2 11h20v2H2zM2 18h20v2H2z"></path></g></svg></button>
                <div v-cloak id="docs-sidebar-toggle"></div>
        
                <!-- Logo -->
                <div class="flex items-center justify-between h-full py-2 md:w-75">
                    <div class="flex items-center px-2 md:px-6">
                        <a id="docs-site-logo" href="../../" class="flex items-center leading-snug text-2xl">
                            <span class="w-10 mr-2 grow-0 shrink-0 overflow-hidden">
                                <img class="max-h-10 dark:hidden md:inline-block" src="../../static/saintly-logo.svg">
                                <img class="max-h-10 hidden dark:inline-block" src="../../static/saintly-logo-dark.svg">
                            </span>
                            <span class="dark:text-white font-semibold line-clamp-1 md:line-clamp-2">S.KYUHWN</span>
                        </a>
                    </div>
        
                    <span class="hidden h-8 border-r md:inline-block dark:border-dark-650"></span>
                </div>
        
                <div class="flex justify-between md:grow">
                    <!-- Top Nav -->
                    <nav class="hidden md:flex">
                        <ul class="flex flex-col mb-4 md:pl-16 md:mb-0 md:flex-row md:items-center">
                            <li class="mr-6">
                                <a class="py-2 md:mb-0 inline-flex items-center text-sm whitespace-nowrap transition-colors duration-200 ease-linear md:text-blue-500 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-200" href="../../">Home</a>
                            </li>
                            <li class="mr-6">
                                <a class="py-2 md:mb-0 inline-flex items-center text-sm whitespace-nowrap transition-colors duration-200 ease-linear md:text-blue-500 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-200" href="https://github.com/underthelights/">GitHub</a>
                            </li>
                            <li class="mr-6">
                                <a class="py-2 md:mb-0 inline-flex items-center text-sm whitespace-nowrap transition-colors duration-200 ease-linear md:text-blue-500 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-200" href="https://drive.google.com/file/d/1lcEg4fXJvTQlCKW5mWai_ej8NZGg21yT/view">Resume</a>
                            </li>
                            <li class="mr-6">
                                <a class="py-2 md:mb-0 inline-flex items-center text-sm whitespace-nowrap transition-colors duration-200 ease-linear md:text-blue-500 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-200" href="https://www.linkedin.com/in/kyuhwan-shim/">Linkedin</a>
                            </li>
                            <li class="mr-6">
                                <a class="py-2 md:mb-0 inline-flex items-center text-sm whitespace-nowrap transition-colors duration-200 ease-linear md:text-blue-500 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-200" href="https://underthelights.github.io">GitBlog</a>
                            </li>
        
                        </ul>
                    </nav>
        
                    <!-- Header Right Skeleton -->
                    <div v-cloak class="flex justify-end grow skeleton">
        
                        <!-- Search input mock -->
                        <div class="relative hidden w-40 lg:block lg:max-w-sm lg:ml-auto">
                            <div class="absolute flex items-center justify-center h-full pl-3 dark:text-dark-300">
                                <svg xmlns="http://www.w3.org/2000/svg" class="icon-base" width="16" height="16" viewBox="0 0 24 24" aria-labelledby="icon" role="presentation"  style="margin-bottom: 1px;"><g fill="currentColor" ><path d="M21.71 20.29l-3.68-3.68A8.963 8.963 0 0020 11c0-4.96-4.04-9-9-9s-9 4.04-9 9 4.04 9 9 9c2.12 0 4.07-.74 5.61-1.97l3.68 3.68c.2.19.45.29.71.29s.51-.1.71-.29c.39-.39.39-1.03 0-1.42zM4 11c0-3.86 3.14-7 7-7s7 3.14 7 7c0 1.92-.78 3.66-2.04 4.93-.01.01-.02.01-.02.01-.01.01-.01.01-.01.02A6.98 6.98 0 0111 18c-3.86 0-7-3.14-7-7z" ></path></g></svg>
                            </div>
        
                            <input class="w-full h-10 transition-colors duration-200 ease-in bg-gray-200 border border-transparent rounded md:text-sm hover:bg-white hover:border-gray-300 focus:outline-none focus:bg-white focus:border-gray-500 dark:bg-dark-600 dark:border-dark-600 placeholder-gray-400 dark:placeholder-dark-400"
                            style="padding: 0.625rem 0.75rem 0.625rem 2rem" type="text" placeholder="Search" />
                        </div>
        
                        <!-- Mobile search button mock -->
                        <div class="flex items-center justify-center w-10 h-10 lg:hidden">
                            <svg xmlns="http://www.w3.org/2000/svg" class="shrink-0 icon-base" width="20" height="20" viewBox="0 0 24 24" aria-labelledby="icon" role="presentation"  style="margin-bottom: 0px;"><g fill="currentColor" ><path d="M21.71 20.29l-3.68-3.68A8.963 8.963 0 0020 11c0-4.96-4.04-9-9-9s-9 4.04-9 9 4.04 9 9 9c2.12 0 4.07-.74 5.61-1.97l3.68 3.68c.2.19.45.29.71.29s.51-.1.71-.29c.39-.39.39-1.03 0-1.42zM4 11c0-3.86 3.14-7 7-7s7 3.14 7 7c0 1.92-.78 3.66-2.04 4.93-.01.01-.02.01-.02.01-.01.01-.01.01-.01.02A6.98 6.98 0 0111 18c-3.86 0-7-3.14-7-7z" ></path></g></svg>
                        </div>
        
                        <!-- Dark mode switch placehokder -->
                        <div class="w-10 h-10 lg:ml-2"></div>
        
                        <!-- History button mock -->
                        <div class="flex items-center justify-center w-10 h-10" style="margin-right: -0.625rem;">
                            <svg xmlns="http://www.w3.org/2000/svg" class="shrink-0 icon-base" width="22" height="22" viewBox="0 0 24 24" aria-labelledby="icon" role="presentation"  style="margin-bottom: 0px;"><g fill="currentColor" ><g ><path d="M12.01 6.01c-.55 0-1 .45-1 1V12a1 1 0 00.4.8l3 2.22a.985.985 0 001.39-.2.996.996 0 00-.21-1.4l-2.6-1.92V7.01c.02-.55-.43-1-.98-1z"></path><path d="M12.01 1.91c-5.33 0-9.69 4.16-10.05 9.4l-.29-.26a.997.997 0 10-1.34 1.48l1.97 1.79c.19.17.43.26.67.26s.48-.09.67-.26l1.97-1.79a.997.997 0 10-1.34-1.48l-.31.28c.34-4.14 3.82-7.41 8.05-7.41 4.46 0 8.08 3.63 8.08 8.09s-3.63 8.08-8.08 8.08c-2.18 0-4.22-.85-5.75-2.4a.996.996 0 10-1.42 1.4 10.02 10.02 0 007.17 2.99c5.56 0 10.08-4.52 10.08-10.08.01-5.56-4.52-10.09-10.08-10.09z"></path></g></g></svg>
                        </div>
                    </div>
        
                    <div v-cloak class="flex justify-end grow">
                        <div id="docs-mobile-search-button"></div>
                        <doc-search-desktop></doc-search-desktop>
        
                        <doc-theme-switch class="lg:ml-2"></doc-theme-switch>
                        <doc-history></doc-history>
                    </div>
                </div>
            </div>
        </header>
    
        <div class="container relative flex bg-white">
            <!-- Sidebar Skeleton -->
            <div v-cloak class="fixed flex flex-col shrink-0 duration-300 ease-in-out bg-gray-100 border-gray-200 sidebar top-20 w-75 border-r h-screen md:sticky transition-transform skeleton dark:bg-dark-800 dark:border-dark-650">
            
                <!-- Render this div, if config.showSidebarFilter is `true` -->
                <div class="flex items-center h-16 px-6">
                    <input class="w-full h-8 px-3 py-2 transition-colors duration-200 ease-linear bg-white border border-gray-200 rounded shadow-none text-sm focus:outline-none focus:border-gray-600 dark:bg-dark-600 dark:border-dark-600" type="text" placeholder="Filter" />
                </div>
            
                <div class="pl-6 mb-4 mt-1">
                    <div class="w-32 h-3 mb-4 bg-gray-200 rounded-full loading dark:bg-dark-600"></div>
                    <div class="w-48 h-3 mb-4 bg-gray-200 rounded-full loading dark:bg-dark-600"></div>
                    <div class="w-40 h-3 mb-4 bg-gray-200 rounded-full loading dark:bg-dark-600"></div>
                    <div class="w-32 h-3 mb-4 bg-gray-200 rounded-full loading dark:bg-dark-600"></div>
                    <div class="w-48 h-3 mb-4 bg-gray-200 rounded-full loading dark:bg-dark-600"></div>
                    <div class="w-40 h-3 mb-4 bg-gray-200 rounded-full loading dark:bg-dark-600"></div>
                </div>
            
                <div class="shrink-0 mt-auto bg-transparent dark:border-dark-650">
                    <a class="flex items-center justify-center flex-nowrap h-16 text-gray-400 dark:text-dark-400 hover:text-gray-700 dark:hover:text-dark-300 transition-colors duration-150 ease-in docs-powered-by" target="_blank" href="https://retype.com/" rel="noopener">
                        <span class="text-xs whitespace-nowrap">Powered by</span>
                        <svg xmlns="http://www.w3.org/2000/svg" class="ml-2" fill="currentColor" width="96" height="20" overflow="visible"><path d="M0 0v20h13.59V0H0zm11.15 17.54H2.44V2.46h8.71v15.08zM15.8 20h2.44V4.67L15.8 2.22zM20.45 6.89V20h2.44V9.34z"/><g><path d="M40.16 8.44c0 1.49-.59 2.45-1.75 2.88l2.34 3.32h-2.53l-2.04-2.96h-1.43v2.96h-2.06V5.36h3.5c1.43 0 2.46.24 3.07.73s.9 1.27.9 2.35zm-2.48 1.1c.26-.23.38-.59.38-1.09 0-.5-.13-.84-.4-1.03s-.73-.28-1.39-.28h-1.54v2.75h1.5c.72 0 1.2-.12 1.45-.35zM51.56 5.36V7.2h-4.59v1.91h4.13v1.76h-4.13v1.92h4.74v1.83h-6.79V5.36h6.64zM60.09 7.15v7.48h-2.06V7.15h-2.61V5.36h7.28v1.79h-2.61zM70.81 14.64h-2.06v-3.66l-3.19-5.61h2.23l1.99 3.45 1.99-3.45H74l-3.19 5.61v3.66zM83.99 6.19c.65.55.97 1.4.97 2.55s-.33 1.98-1 2.51-1.68.8-3.04.8h-1.23v2.59h-2.06V5.36h3.26c1.42 0 2.45.28 3.1.83zm-1.51 3.65c.25-.28.37-.69.37-1.22s-.16-.92-.48-1.14c-.32-.23-.82-.34-1.5-.34H79.7v3.12h1.38c.68 0 1.15-.14 1.4-.42zM95.85 5.36V7.2h-4.59v1.91h4.13v1.76h-4.13v1.92H96v1.83h-6.79V5.36h6.64z"/></g></svg>
                    </a>
                </div>
            </div>
            
            <!-- Sidebar component -->
            <doc-sidebar v-cloak>
                <template #sidebar-footer>
                    <div class="shrink-0 mt-auto border-t md:bg-transparent md:border-none dark:border-dark-650">
            
                        <div class="py-3 px-6 md:hidden border-b dark:border-dark-650">
                            <nav>
                                <ul class="flex flex-wrap justify-center items-center">
                                    <li class="mr-6">
                                        <a class="block py-1 inline-flex items-center text-sm whitespace-nowrap transition-colors duration-200 ease-linear md:text-blue-500 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-200" href="../../">Home</a>
                                    </li>
                                    <li class="mr-6">
                                        <a class="block py-1 inline-flex items-center text-sm whitespace-nowrap transition-colors duration-200 ease-linear md:text-blue-500 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-200" href="https://github.com/underthelights/">GitHub</a>
                                    </li>
                                    <li class="mr-6">
                                        <a class="block py-1 inline-flex items-center text-sm whitespace-nowrap transition-colors duration-200 ease-linear md:text-blue-500 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-200" href="https://drive.google.com/file/d/1lcEg4fXJvTQlCKW5mWai_ej8NZGg21yT/view">Resume</a>
                                    </li>
                                    <li class="mr-6">
                                        <a class="block py-1 inline-flex items-center text-sm whitespace-nowrap transition-colors duration-200 ease-linear md:text-blue-500 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-200" href="https://www.linkedin.com/in/kyuhwan-shim/">Linkedin</a>
                                    </li>
                                    <li class="mr-6">
                                        <a class="block py-1 inline-flex items-center text-sm whitespace-nowrap transition-colors duration-200 ease-linear md:text-blue-500 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-200" href="https://underthelights.github.io">GitBlog</a>
                                    </li>
            
                                </ul>
                            </nav>
                        </div>
            
                        <a class="flex items-center justify-center flex-nowrap h-16 text-gray-400 dark:text-dark-400 hover:text-gray-700 dark:hover:text-dark-300 transition-colors duration-150 ease-in docs-powered-by" target="_blank" href="https://retype.com/" rel="noopener">
                            <span class="text-xs whitespace-nowrap">Powered by</span>
                            <svg xmlns="http://www.w3.org/2000/svg" class="ml-2" fill="currentColor" width="96" height="20" overflow="visible"><path d="M0 0v20h13.59V0H0zm11.15 17.54H2.44V2.46h8.71v15.08zM15.8 20h2.44V4.67L15.8 2.22zM20.45 6.89V20h2.44V9.34z"/><g><path d="M40.16 8.44c0 1.49-.59 2.45-1.75 2.88l2.34 3.32h-2.53l-2.04-2.96h-1.43v2.96h-2.06V5.36h3.5c1.43 0 2.46.24 3.07.73s.9 1.27.9 2.35zm-2.48 1.1c.26-.23.38-.59.38-1.09 0-.5-.13-.84-.4-1.03s-.73-.28-1.39-.28h-1.54v2.75h1.5c.72 0 1.2-.12 1.45-.35zM51.56 5.36V7.2h-4.59v1.91h4.13v1.76h-4.13v1.92h4.74v1.83h-6.79V5.36h6.64zM60.09 7.15v7.48h-2.06V7.15h-2.61V5.36h7.28v1.79h-2.61zM70.81 14.64h-2.06v-3.66l-3.19-5.61h2.23l1.99 3.45 1.99-3.45H74l-3.19 5.61v3.66zM83.99 6.19c.65.55.97 1.4.97 2.55s-.33 1.98-1 2.51-1.68.8-3.04.8h-1.23v2.59h-2.06V5.36h3.26c1.42 0 2.45.28 3.1.83zm-1.51 3.65c.25-.28.37-.69.37-1.22s-.16-.92-.48-1.14c-.32-.23-.82-.34-1.5-.34H79.7v3.12h1.38c.68 0 1.15-.14 1.4-.42zM95.85 5.36V7.2h-4.59v1.91h4.13v1.76h-4.13v1.92H96v1.83h-6.79V5.36h6.64z"/></g></svg>
                        </a>
                    </div>
                </template>
            </doc-sidebar>
    
            <div class="grow min-w-0 dark:bg-dark-850">
                <!-- Render "toolbar" template here on api pages --><!-- Render page content -->
                <div class="flex">
                    <div class="grow min-w-0 px-6 md:px-16">
                        <main class="relative pt-6 pb-16">
                            <div class="docs-markdown" id="docs-content">
                                <!-- Rendered if sidebar right is enabled -->
                                <div id="docs-sidebar-right-toggle"></div>
                
                                <!-- Page content  -->
<doc-anchor-target id="11-dynamic-memory-allocation-advanced-concepts" class="break-words">
    <h1>
        <doc-anchor-trigger class="header-anchor-trigger" to="#11-dynamic-memory-allocation-advanced-concepts">#</doc-anchor-trigger>
        <span>11. Dynamic Memory Allocation: Advanced Concepts</span>
    </h1>
</doc-anchor-target>
<p>Dynamic Memory Allocation: Advanced Concepts
CSE4100: System Programming
Youngjae Kim (PhD)</p>
<doc-anchor-target id="explicit-free-list">
    <h1>
        <doc-anchor-trigger class="header-anchor-trigger" to="#explicit-free-list">#</doc-anchor-trigger>
        <span>Explicit Free List</span>
    </h1>
</doc-anchor-target>
<doc-anchor-target id="keeping-track-of-free-blocks">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#keeping-track-of-free-blocks">#</doc-anchor-trigger>
        <span>Keeping Track of Free Blocks</span>
    </h2>
</doc-anchor-target>
<p><figure class="content-center">
    <img src="../11/untitled.png" alt="Untitled" />
    <figcaption class="caption">Untitled</figcaption>
</figure>
</p>
<ol>
<li>forward traverse : 모든 것을 scan하여 뒤져야 free block을 찾을 수 있음
<ul>
<li>adv ) spatial : 4/5만큼을 사용 가능</li>
<li>free block을 찾기 위해 모두 뒤져 정책에 찾아 free block</li>
</ul>
</li>
<li>explicit free list : Size가 아니라 word를 가져다 다음의 free block을 가리키는 방법
<ul>
<li>adv) linear search할 때 method2 : allocated block skip 가능해서 빠름</li>
<li>disadv ) successor에 해당하는 3/5만큼을 사용 가능</li>
</ul>
</li>
<li>Class 마다 linked list로 연결 - 굉장히 빠르게 가장 fit할수 있는 block을 빠르게 찾을 수 있는 기법.</li>
<li>크기에 따라 븐류한 block</li>
</ol>
<doc-anchor-target id="explicit-free-lists">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#explicit-free-lists">#</doc-anchor-trigger>
        <span>Explicit Free Lists</span>
    </h2>
</doc-anchor-target>
<ul>
<li>Header, footer : coleascing - 앞과 뒤</li>
<li>successor- precedesor : Explicit한 방법으로 free list 관리 가능.</li>
</ul>
<p><figure class="content-center">
    <img src="11/untitled201.png" alt="Untitled" />
    <figcaption class="caption">Untitled</figcaption>
</figure>
</p>
<ul>
<li><p>Maintain list(s) of free blocks, not all blocks</p>
</li>
<li><p>The “next” free block could be anywhere</p>
<ul>
<li>So we need to store forward/back pointers, not just sizes</li>
</ul>
</li>
<li><p>Still need boundary tags for coalescing</p>
</li>
<li><p>Luckily we track only free blocks, so we can use payload area</p>
<ul>
<li>lucky하게도 free list만 관리 가능 → payload 영역 사용의 단점</li>
</ul>
</li>
<li><p>Logically:</p>
<p><img src="11/untitled202.png" alt="Untitled" /></p>
</li>
<li><p>Physically: blocks can be in any order AB</p>
<p><img src="11/untitled203.png" alt="Untitled" /></p>
</li>
</ul>
<doc-anchor-target id="allocating-from-explicit-free-lists">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#allocating-from-explicit-free-lists">#</doc-anchor-trigger>
        <span>Allocating From Explicit Free Lists</span>
    </h2>
</doc-anchor-target>
<p>Doubly linked list로 연결되어있다고 하자 :</p>
<p>회색 해당한 만큼을 allocate → free list에 있을 필요 없으므로 split하고 남은 block과 연결해줌</p>
<ul>
<li>ptr update를 통해 앞에서부터/뒤에서부터 연결, splitting</li>
</ul>
<p><figure class="content-center">
    <img src="11/untitled204.png" alt="Untitled" />
    <figcaption class="caption">Untitled</figcaption>
</figure>
</p>
<p><figure class="content-center">
    <img src="11/untitled205.png" alt="Untitled" />
    <figcaption class="caption">Untitled</figcaption>
</figure>
</p>
<doc-anchor-target id="freeing-with-explicit-free-lists">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#freeing-with-explicit-free-lists">#</doc-anchor-trigger>
        <span>Freeing With Explicit Free Lists</span>
    </h2>
</doc-anchor-target>
<ul>
<li><p>Insertion policy: Where in the free list do you put a newly freed block?</p>
</li>
<li><p>복잡 : free list를 관리해야 하는데 가져다 return하게 되면 insertion해야 하는데 그 policy</p>
<ul>
<li>→ search time overhead가 큼</li>
</ul>
</li>
<li><p>LIFO (last-in-first-out) policy</p>
<ul>
<li>Insert freed block at the beginning of the free list
맨 앞에다 free block을 가져다 연결시켜줌</li>
<li>Pro: simple and constant time</li>
<li>Con: studies suggest fragmentation is worse than address ordered</li>
</ul>
</li>
<li><p>Address-ordered policy</p>
<ul>
<li>Insert freed blocks so that free list blocks are always in address order:
<ul>
<li><code v-pre>addr(prev) &lt; addr(curr) &lt; addr(next)</code></li>
</ul>
</li>
<li>Con: requires search</li>
<li>Pro: studies suggest fragmentation is lower than LIFO</li>
</ul>
<ol start="2">
<li>Address ordered policy</li>
</ol>
<ul>
<li>insert되는 block들이 작은 주소부터 높은 주소 순으로 sorting</li>
</ul>
<p>→ addr ordered 방법보다 fragmentation 경감</p>
<ul>
<li>실제 allocation할 때 어떤 block을 allocation하느냐를 Allocation해야 하기 때문에, address에 따라 순서대로 search하며 선택해야 하는 문제가 있음</li>
</ul>
</li>
</ul>
<doc-anchor-target id="freeing-with-a-lifo-policy-case-1">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#freeing-with-a-lifo-policy-case-1">#</doc-anchor-trigger>
        <span>Freeing With a LIFO Policy (Case 1)</span>
    </h2>
</doc-anchor-target>
<ul>
<li>다른 free한 block을 가리킨다고 하자.</li>
<li>block이 memory상 어딘가 존재할 것 : 앞 뒤에 있는 것을 header-footer 방법을 통해 조사함
<ul>
<li>→ 앞뒤 allocated면 생각보다 간단하게</li>
</ul>
</li>
<li>header 다음 next에 해당하는 ptr를 다음을 가르키게 함</li>
<li>즉) 앞 뒤가 allocate되면 상대적으로 simple</li>
</ul>
<p><figure class="content-center">
    <img src="11/untitled206.png" alt="Untitled" />
    <figcaption class="caption">Untitled</figcaption>
</figure>
</p>
<ul>
<li><p>Insert the freed block at the root of the list</p>
<p><img src="11/untitled207.png" alt="Untitled" /></p>
</li>
</ul>
<doc-anchor-target id="freeing-with-a-lifo-policy-case-2">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#freeing-with-a-lifo-policy-case-2">#</doc-anchor-trigger>
        <span>Freeing With a LIFO Policy (Case 2)</span>
    </h2>
</doc-anchor-target>
<p><figure class="content-center">
    <img src="11/untitled208.png" alt="Untitled" />
    <figcaption class="caption">Untitled</figcaption>
</figure>
</p>
<ul>
<li><p>Splice out successor block, coalesce both memory blocks and insert the new block at the root of the list</p>
<p><img src="11/untitled209.png" alt="Untitled" /></p>
</li>
</ul>
<doc-anchor-target id="freeing-with-a-lifo-policy-case-3">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#freeing-with-a-lifo-policy-case-3">#</doc-anchor-trigger>
        <span>Freeing With a LIFO Policy (Case 3)</span>
    </h2>
</doc-anchor-target>
<p><figure class="content-center">
    <img src="11/untitled2010.png" alt="Untitled" />
    <figcaption class="caption">Untitled</figcaption>
</figure>
</p>
<ul>
<li><p>Splice out predecessor block, coalesce both memory blocks, and insert the new block at the root of the list</p>
<p><img src="11/untitled2011.png" alt="Untitled" /></p>
</li>
</ul>
<doc-anchor-target id="freeing-with-a-lifo-policy-case-4">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#freeing-with-a-lifo-policy-case-4">#</doc-anchor-trigger>
        <span>Freeing With a LIFO Policy (Case 4)</span>
    </h2>
</doc-anchor-target>
<p><figure class="content-center">
    <img src="11/untitled2012.png" alt="Untitled" />
    <figcaption class="caption">Untitled</figcaption>
</figure>
</p>
<ul>
<li><p>Splice out predecessor and successor blocks, coalesce all 3 memory blocks and insert the new block at the root of the list</p>
<p><img src="11/untitled2013.png" alt="Untitled" /></p>
</li>
</ul>
<doc-anchor-target id="explicit-list-summary">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#explicit-list-summary">#</doc-anchor-trigger>
        <span>Explicit List Summary</span>
    </h2>
</doc-anchor-target>
<p>모든 block을 뒤지지 않아 좀 더 빠른 속도를 가지지만 좀 복잡함 : free state 관리 구현</p>
<ul>
<li><p>block의 크기가 최소 5word 이상이어야 함</p>
</li>
<li><p>Comparison to implicit list:</p>
<ul>
<li>Allocate is linear time in number of free blocks instead of all blocks
<ul>
<li>Much faster when most of the memory is full</li>
</ul>
</li>
<li>Slightly more complicated allocate and free since needs to splice blocks in and out of the list</li>
<li>Some extra space for the links (2 extra words needed for each block)
<ul>
<li>Does this increase internal fragmentation?</li>
</ul>
</li>
</ul>
</li>
<li><p>Most common use of linked lists is in conjunction with segregated free lists
Free block들을 ptr로 연결하여 ll로 관리함</p>
<ul>
<li><p>Keep multiple linked lists of different size classes, or possibly for different types of objects</p>
</li>
<li><p>LIFO queue</p>
</li>
<li><p>단점 : free block을 link했지만 각 block 크기 가변적</p>
<p>→ fragmentation이 작은 block을 찾으려면 best fit policy에 따라 처음부터 끝까지 뒤져봐야 함.</p>
</li>
</ul>
</li>
</ul>
<doc-anchor-target id="segregated-free-list">
    <h1>
        <doc-anchor-trigger class="header-anchor-trigger" to="#segregated-free-list">#</doc-anchor-trigger>
        <span>Segregated Free List</span>
    </h1>
</doc-anchor-target>
<ul>
<li><p>어떻게 segregate : n개의 size class를 만들어 n개의 free block을 안에다 집합</p>
<p>→ 다른 크기의 size class에 따라서 각각 다른 free list 관리하는 기법</p>
</li>
</ul>
<doc-anchor-target id="segregated-list-seglist-allocators">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#segregated-list-seglist-allocators">#</doc-anchor-trigger>
        <span>Segregated List (Seglist) Allocators</span>
    </h2>
</doc-anchor-target>
<p><figure class="content-center">
    <img src="11/untitled2014.png" alt="Untitled" />
    <figcaption class="caption">Untitled</figcaption>
</figure>
</p>
<ul>
<li><p>Each size class of blocks has its own free list</p>
</li>
<li><p>Often have separate classes for each small size</p>
</li>
<li><p>For larger sizes: One class for each two-power size</p>
</li>
<li><p>이전 explicit free list : 하나의 단일 lifo queue</p>
<p>→ 지금 : 각각의 size을 가지는 list</p>
</li>
<li><p>장점 : best fit - fragmentation 최소화할 수 있는 block을 찾았다면 여기서는 class 별 로 나누었기에 내게 맞는 class를 찾을 수 있는 기법</p>
</li>
</ul>
<doc-anchor-target id="seglist-allocator">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#seglist-allocator">#</doc-anchor-trigger>
        <span>Seglist Allocator</span>
    </h2>
</doc-anchor-target>
<p>malloc(n)</p>
<p>새롭게 요청된 메모리로부터 n개의 byte block 할당.</p>
<p><figure class="content-center">
    <img src="11/untitled2015.png" alt="Untitled" />
    <figcaption class="caption">Untitled</figcaption>
</figure>
</p>
<ul>
<li><p>Given an array of free lists, each one for some size class</p>
</li>
<li><p>To allocate a block of size n:</p>
<ul>
<li>Search appropriate free list for block of size m &gt; n
처음부터 찾는다 : m&gt;n인 m의 크기를 가진 free list를 찾는다
<ul>
<li><p>ex. malloc(4)라고 하면 4를 수용하는 block을 가진 class를 찾음</p>
<p>→ block이 있는 경우는 block할당, 나머지 frag는 집어넣음</p>
<ul>
<li><p>malloc(6)을 요청했다면 5-8 class에서 할당받는다.</p>
<p>→ 8 size block 중 나머지 2개는 1-2class로 이동한다.</p>
</li>
</ul>
<p>(구현 별 문제 : 나머지 fragment를 어떻게 처리할 것인가. 앞에다 붙이는게 빠를수도 있다 (LIFO니까))</p>
</li>
<li><p>m payload, n 실제 class의 size
Payload를 고려하는 것에 따라 m&gt;=n</p>
</li>
</ul>
</li>
<li>If an appropriate block is found:
<ul>
<li>Split block and place fragment on appropriate list (optional)</li>
</ul>
</li>
<li>If no block is found, try next larger class
만일 block size가 없다면 더 큰 class로 이동</li>
<li>Repeat until block is found</li>
</ul>
</li>
<li><p>If no block is found:</p>
<ul>
<li>Request additional heap memory from OS (using sbrk())</li>
<li>Allocate block of n bytes from this new memory</li>
<li>Place remainder as a single free block in largest size class.</li>
</ul>
</li>
<li><p>To free a block:</p>
<ul>
<li>Coalesce and place on appropriate list
<ul>
<li>block의 free : 앞, 뒤를 보고 coalesce</li>
</ul>
</li>
</ul>
</li>
<li><p>Advantages of seglist allocators</p>
<ul>
<li><strong>Higher throughput) malloc을 할 때 성능이 좋다</strong>
<ul>
<li>log time for power-of-two size classes</li>
<li>size class로 나뉘어져 있기에 fragmentation을 최소화하면서 적합한 class를 빨리 찾을 수 있다.</li>
</ul>
</li>
<li><strong>Better memory utilization</strong>
<ul>
<li>First-fit search of segregated free list approximates a best-fit search of entire heap.
<ul>
<li>앞에서부터 찾더라도 나보다도 큰 공간이지만 나중에 보니 fragmentation을 최소화할 수 있는 block이 있을 수도 있다.</li>
</ul>
</li>
<li>Extreme case: Giving each block its own size class is equivalent to best-fit.
<ul>
<li>모든 각각의 block마다 size class를 두고 나서 best fit 해당할수도 있으나 class를 너무 많이 뽑아야 함.</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li></li>
</ul>
<doc-anchor-target id="more-info-on-allocators">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#more-info-on-allocators">#</doc-anchor-trigger>
        <span>More Info on Allocators</span>
    </h2>
</doc-anchor-target>
<ul>
<li>
<ol type="A" start="4">
<li>Knuth, “The Art of Computer Programming”, 2nd edition, Addison Wesley, 1973</li>
</ol>
<ul>
<li>The classic reference on dynamic storage allocation</li>
</ul>
</li>
<li>Wilson et al, “Dynamic Storage Allocation: A Survey and Critical Review”, Proc. 1995 Int’l Workshop on Memory Management, Kinross, Scotland, Sept, 1995.
<ul>
<li>Comprehensive survey</li>
</ul>
</li>
</ul>
<doc-anchor-target id="garbage-collection">
    <h1>
        <doc-anchor-trigger class="header-anchor-trigger" to="#garbage-collection">#</doc-anchor-trigger>
        <span>Garbage collection</span>
    </h1>
</doc-anchor-target>
<doc-anchor-target id="implicit-memory-management-garbage-collection">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#implicit-memory-management-garbage-collection">#</doc-anchor-trigger>
        <span>Implicit Memory Management: Garbage Collection</span>
    </h2>
</doc-anchor-target>
<p>integer pointer</p>
<ul>
<li><p>int type 128 byte (32 * 4byte) (heap에 할당)</p>
</li>
<li><p>stack에 할당 (local variable)</p>
</li>
<li><p>address space를 보면</p>
<p><img src="11/untitled2016.png" alt="Untitled" /></p>
</li>
</ul>
<p>실제 사용하지 않는 공간임에도 불구하고 자리를 차지함</p>
<ul>
<li><p>garbage collection : 자동으로 heap에 할당된 storage들에 대한 reclamation</p>
</li>
<li><p>Garbage collection: automatic reclamation of heap-allocated storage—application never has to free</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-c"><code v-pre class="language-c">void foo() {
		int *p = malloc(128);
		return; /** p block is now garbage */
}</code></pre>
</doc-codeblock></div>
</li>
<li><p>Common in many dynamic languages:</p>
<ul>
<li>Python, Ruby, Java, Perl, ML, Lisp, Mathematica</li>
</ul>
</li>
<li><p>Variants (“conservative” garbage collectors) exist for C and C++</p>
<ul>
<li>However, cannot necessarily collect all garbage</li>
</ul>
</li>
</ul>
<doc-anchor-target id="garbage-collection-1">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#garbage-collection-1">#</doc-anchor-trigger>
        <span>Garbage Collection</span>
    </h2>
</doc-anchor-target>
<p>c에서의 garbage collection 구현의 어려움</p>
<ul>
<li><p>How does the memory manager know when memory can be freed?
내가 할당한 memory allocation이 runtime시에 언제 free될 것이냐</p>
<ul>
<li>In general we cannot know what is going to be used in the future since it depends on conditionals</li>
<li>But we can tell that certain blocks cannot be used if there are no pointers to them</li>
<li>= program이 어떻게 실행될지 execution order를 정확히 모르면 모른다.
그러나 적어도, heap에 할당된 memory object를 point하는 ptr가 없다면 해당 allocated block은 사용되지 않는다.</li>
</ul>
<p>(point하는 ptr가 없으니까 나중에 garbage collect해도 되는구나)</p>
</li>
<li><p>Must make certain assumptions about pointers</p>
<ol>
<li>memory int type에 있는 변수 안의 값이 ptr 일수도 아닐수도 있다.</li>
</ol>
<ul>
<li>Memory manager can distinguish pointers from non-pointers</li>
<li>ptr 는 다른 memory obj를 가리키는 address일수도, int일수도 있으나 이를 구분할 방법은 c에서는 없음.</li>
<li>memory manager가 할 수 있다고 가정</li>
</ul>
<ol start="2">
<li>어떤 block이든간에 시작을 point함</li>
</ol>
<ul>
<li>All pointers point to the start of a block</li>
</ul>
<ol start="3">
<li>type casting같이 ptr 숨김을 못한다.</li>
</ol>
<ul>
<li>Cannot hide pointers</li>
<li>(e.g., by coercing them to an int, and then back again)</li>
</ul>
</li>
</ul>
<doc-anchor-target id="classical-gc-algorithms">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#classical-gc-algorithms">#</doc-anchor-trigger>
        <span>Classical GC Algorithms</span>
    </h2>
</doc-anchor-target>
<ul>
<li>Mark-and-sweep collection (McCarthy, 1960)
<ul>
<li>Does not move blocks (unless you also “compact”)</li>
</ul>
</li>
<li>Reference counting (Collins, 1960)
<ul>
<li>Does not move blocks (not discussed)</li>
</ul>
</li>
<li>Copying collection (Minsky, 1963)
<ul>
<li>Moves blocks (not discussed)</li>
</ul>
</li>
<li>Generational Collectors (Lieberman and Hewitt, 1983)
<ul>
<li>Collection based on lifetimes
<ul>
<li>Most allocations become garbage very soon</li>
<li>So focus reclamation work on zones of memory recently allocated</li>
</ul>
</li>
</ul>
</li>
<li>For more information:
<ul>
<li>Jones and Lin, “Garbage Collection: Algorithms for Automatic Dynamic Memory”, John Wiley &amp; Sons, 1996. Bryant and O’Hallaron, Computer Systems: A Programmer’s Perspective, Third Edition</li>
</ul>
</li>
</ul>
<doc-anchor-target id="memory-as-a-graph">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#memory-as-a-graph">#</doc-anchor-trigger>
        <span>Memory as a Graph</span>
    </h2>
</doc-anchor-target>
<p>grapy로 표현 : heap memory object로 만든 direct graph</p>
<ul>
<li><p>어떤 ds를 만들었는데 heap 안에 있는 object를 stack밖에서 point하는 경우</p>
<ul>
<li>root node는 heap 안에 있는 것을 가리키는 형상</li>
</ul>
</li>
<li><p>direct graph :</p>
<ul>
<li>모종의 자료구조로 인해 binary tree를 heap 안에서 만들었다고 하면 Root로부터 시작하여 heap 안의 object를 point하는 direct graph</li>
</ul>
</li>
<li><p>어느 순간에 가게 되면 외부에서 가리키는 ptr이 없어지는 경우도 존재.</p>
</li>
<li><p>ex. heap에는 이미 할당되어 있지만 함수가 return되며 point하는 local var이 사라짐</p>
<p>→ not-reachable garbage 생성</p>
<p>heap node는 이런식으로 tree로 표현되지만 실제로는 1dim array : 어떤 부분은 free하고 어떤 부분은 allocated, 어떤 부분은 reachable-not reachable</p>
</li>
<li><p>식별할 수 있다면 reachable하지 않는 놈들을 free하면 됨 : mark and sweep algorithm</p>
</li>
<li><p>We view memory as a directed graph</p>
<ul>
<li>Each block is a node in the graph /  Each pointer is an edge in the graph</li>
<li>Locations not in the heap that contain pointers into the heap are called root nodes (e.g. registers, locations on the stack, global variables)</li>
</ul>
<p><img src="11/untitled2017.png" alt="Untitled" /></p>
<ul>
<li>A node (block) is reachable if there is a path from any root to that node.</li>
<li>Non-reachable nodes are garbage (cannot be needed by the application)</li>
</ul>
</li>
</ul>
<doc-anchor-target id="mark-and-sweep-collecting">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#mark-and-sweep-collecting">#</doc-anchor-trigger>
        <span>Mark and Sweep Collecting</span>
    </h2>
</doc-anchor-target>
<ul>
<li><p>Can build on top of malloc/free package</p>
<ul>
<li>Allocate using malloc until you “run out of space”</li>
<li>malloc을 지속한다 : 공간이 없을 때까지
<ul>
<li>공간이 없다 = sbrk를 써서 계속 확장하더라도 malloc이 잘 안되는 경우 memory 공간이 없음</li>
</ul>
</li>
</ul>
</li>
<li><p>When out of space:</p>
<ul>
<li><p>Use extra mark bit in the head of each block</p>
<ul>
<li>Header에다가 extra bit를 가져가 mark한다</li>
<li>mark : 앞서 root에 해당하는 녀석을 인자로 돌려 reachable한 녀석들을 dfs하여 mark bit set</li>
</ul>
</li>
<li><p>Mark: Start at roots and set mark bit on each reachable block</p>
<ul>
<li><p>Recursively Mark를 수행하며 각 block에 reachable한 경우에 한하여 mark해줌</p>
<p>→ not reachable은 allocated되어 있지만 mark bit이 set되어있지 않음</p>
</li>
</ul>
</li>
<li><p>Sweep: Scan all blocks and free blocks that are not marked root</p>
<ul>
<li>1dim 평면의 array의 처음부터 끝 brk까지 scan하며 mark되지 않은 block에 대하여 free</li>
</ul>
</li>
</ul>
<p><img src="11/untitled2018.png" alt="Untitled" /></p>
<ul>
<li>Before mark - free list를 pt하는게 아닌 application 관점에서 앞서의 tree를 구현</li>
<li>after mark - rechable한 경우 mark bit을 setting해줌</li>
<li>after sweep - not rechable 들은 free를 해줌 (allocated but not marked)</li>
</ul>
</li>
</ul>
<doc-anchor-target id="assumptions-for-a-simple-implementation">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#assumptions-for-a-simple-implementation">#</doc-anchor-trigger>
        <span>Assumptions For a Simple Implementation</span>
    </h2>
</doc-anchor-target>
<ul>
<li><p>Application</p>
<ul>
<li><code v-pre>new(n)</code>: returns pointer to new block with all locations cleared
<ul>
<li>New(n) : heap memory obj를 할당하고 ptr를 return</li>
</ul>
</li>
<li><code v-pre>read(b,i)</code>: read location i of block b into register
<ul>
<li>Read(), block b에서 i번째에 해당하는 값을 읽어 register에 집어넣음</li>
</ul>
</li>
<li><code v-pre>write(b,i,v)</code>: write v into location i of block b
<ul>
<li>write(b,i,v) : block b의 i번째에 v를 쓴다.</li>
</ul>
</li>
</ul>
</li>
<li><p>Each block will have a header word
앞에는 header word가 있다고 가정하고 collector를 구현하자.</p>
<ul>
<li>addressed as b[-1], for a block b</li>
<li>Used for different purposes in different collectors</li>
</ul>
</li>
<li><p>functions/Instructions used by the Garbage Collector</p>
<ul>
<li><code v-pre>is_ptr(p)</code>: determines whether p is a pointer
p가 ptr인지 int인지 구분할 수 없지만 구분된다고 가정하자.</li>
<li><code v-pre>length(b)</code>: returns the length of block b, not including the header
block b에서의 header를 제외한 word개수</li>
<li><code v-pre>get_roots()</code>: returns all the roots</li>
</ul>
</li>
</ul>
<doc-anchor-target id="mark-and-sweep-cont">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#mark-and-sweep-cont">#</doc-anchor-trigger>
        <span>Mark and Sweep (cont.)</span>
    </h2>
</doc-anchor-target>
<ul>
<li>Mark using depth-first traversal of the memory graph
<ul>
<li>depth-first traversal : Heap node들은 mark bit가 setting되어있지 않기에 ptr인지 아닌지 체크
<ul>
<li>→ ptr 아니었다면 return, ptr라면 밑으로</li>
<li>markbit set</li>
</ul>
</li>
<li>P의 크기만큼을 보면서 p[i]를 recursive하게 돌아감 → 초록tordls reachable obj에 대해 mark해줌</li>
</ul>
</li>
</ul>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-c"><code v-pre class="language-c">ptr mark(ptr p)
{
    if (!is_ptr(p))
        return; // do nothing if not pointer
    if (markBitSet(p))
        return;                     // check if already marked
    setMarkBit(p);                  // set the mark bit
    for (i = 0; i &lt; length(p); i++) // call mark on all words
}
mark(p[i]); // in the block return;</code></pre>
</doc-codeblock></div>
<ul>
<li><p>Sweep using lengths to find next block</p>
<p>P (시작) end (breakpoint(</p>
</li>
</ul>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-c"><code v-pre class="language-c">ptr sweep(ptr p, ptr end)
{
    while (p &lt; end)
    {
        if markBitSet (p)
            clearMarkBit();
        else if (allocateBitSet(p))
            free(p);
        p += length(p);
    }
}</code></pre>
</doc-codeblock></div>
<doc-anchor-target id="conservative-mark--sweep-in-c">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#conservative-mark--sweep-in-c">#</doc-anchor-trigger>
        <span>Conservative Mark &amp; Sweep in C</span>
    </h2>
</doc-anchor-target>
<p>c 언어 상 p가 가리키는 것이 memory block 중 ptr block, int block일 수 있음</p>
<ul>
<li>memory value type를 저장하지 않기에 우리는 구분 불가능했던 것</li>
<li>구현 방법 : block에서 left/right해서 있는 값은 무조건 ptr라고 하고
<ul>
<li>balenced bt를 만들어 point하여 allocate block을 따라가 mark and sweep한다.</li>
<li>→ conservative하게 정확하게 구분할 수는 없지만 어느정도 determine 한다라고 가정</li>
</ul>
</li>
</ul>
<p>실제 가리키는게 not allocated이지만 allocated라고 가정해놓고 point</p>
<ul>
<li><p>A “conservative garbage collector” for C programs</p>
<ul>
<li><p><code v-pre>is_ptr()</code> determines if a word is a pointer by checking if it points to an allocated block of memory</p>
</li>
<li><p>But, in C pointers can point to the middle of a block</p>
<p><img src="11/untitled2019.png" alt="Untitled" /></p>
</li>
</ul>
</li>
<li><p>So how to find the beginning of the block?</p>
<ul>
<li>Can use a balanced binary tree to keep track of all allocated blocks (key is start-of-block)</li>
<li>Balanced-tree pointers can be stored in header (use two additional words)</li>
</ul>
</li>
<li><p>Left: smaller addresses  / Right: larger addresses</p>
<p>(Left / right)를 통해 balanced bt를 구축하게 됏을 때 left가 alloc 안되어 있지만 되어 있다는 block이라고 하면 garbage collection할 때 memory leak이 발생하기는 하나 구현할 수는 있다.</p>
<p><img src="11/untitled2020.png" alt="Untitled" /></p>
</li>
</ul>
<doc-anchor-target id="memory-related-perils-and-pitfalls">
    <h1>
        <doc-anchor-trigger class="header-anchor-trigger" to="#memory-related-perils-and-pitfalls">#</doc-anchor-trigger>
        <span>Memory-related perils and pitfalls</span>
    </h1>
</doc-anchor-target>
<doc-anchor-target id="memory-related-perils-and-pitfalls-1">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#memory-related-perils-and-pitfalls-1">#</doc-anchor-trigger>
        <span>Memory-Related Perils and Pitfalls</span>
    </h2>
</doc-anchor-target>
<ul>
<li>Dereferencing bad pointers</li>
<li>Reading uninitialized memory</li>
<li>Overwriting memory</li>
<li>Referencing nonexistent variables</li>
<li>Freeing blocks multiple times</li>
<li>Referencing freed blocks</li>
<li>Failing to free blocks</li>
</ul>
<doc-anchor-target id="dereferencing-bad-pointers">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#dereferencing-bad-pointers">#</doc-anchor-trigger>
        <span>Dereferencing Bad Pointers</span>
    </h2>
</doc-anchor-target>
<ul>
<li>The classic scanf bug</li>
</ul>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-c"><code v-pre class="language-c">int val;
...
scanf(“%d”, val);</code></pre>
</doc-codeblock></div>
<doc-anchor-target id="reading-uninitialized-memory">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#reading-uninitialized-memory">#</doc-anchor-trigger>
        <span>Reading Uninitialized Memory</span>
    </h2>
</doc-anchor-target>
<ul>
<li>Assuming that heap data is initialized to zero</li>
</ul>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-c"><code v-pre class="language-c">/* return y = Ax */
int *matvec(int **A, int *x)
{
    int y = malloc(Nsizeof(int));
    int i, j;
    for (i = 0; i &lt; N; i++)
        for (j = 0; j &lt; N; j++)
            y[i] += A[i][j] * x[j];
    return y;
}</code></pre>
</doc-codeblock></div>
<doc-anchor-target id="overwriting-memory">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#overwriting-memory">#</doc-anchor-trigger>
        <span>Overwriting Memory</span>
    </h2>
</doc-anchor-target>
<ul>
<li>Allocating the (possibly) wrong sized object</li>
</ul>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-c"><code v-pre class="language-c">int **p;
p = malloc(Nsizeof(int));
for (i = 0; i &lt; N; i++)
{
    p[i] = malloc(Msizeof(int));
}</code></pre>
</doc-codeblock></div>
<ul>
<li>Off-by-one error</li>
</ul>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-c"><code v-pre class="language-c">int **p;
p = malloc(N * sizeof(int));
for (i = 0; i &lt;= N; i++)
{
    p[i] = malloc(Msizeof(int));
}</code></pre>
</doc-codeblock></div>
<ul>
<li>Not checking the max string size</li>
</ul>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-c"><code v-pre class="language-c">char s[8];
int i;
gets(s); /* reads “123456789” from stdin */</code></pre>
</doc-codeblock></div>
<ul>
<li>Basis for classic buffer overflow attacks</li>
<li>Misunderstanding pointer arithmetic</li>
</ul>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-c"><code v-pre class="language-c">int *search(int *p, int val)
{
    while (*p &amp;&amp; *p != val)
        p += sizeof(int);
    return p;
}</code></pre>
</doc-codeblock></div>
<ul>
<li>Referencing a pointer instead of the object it points to</li>
</ul>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-c"><code v-pre class="language-c">int *BinheapDelete(int **binheap, int *size)
{
    int *packet;
    packet = binheap[0];
    binheap[0] = binheap[*size - 1];
    *size--;
    Heapify(binheap, *size, 0);
    return (packet);
}</code></pre>
</doc-codeblock></div>
<doc-anchor-target id="referencing-nonexistent-variables">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#referencing-nonexistent-variables">#</doc-anchor-trigger>
        <span>Referencing Nonexistent Variables</span>
    </h2>
</doc-anchor-target>
<ul>
<li>Forgetting that local variables disappear when a function returns</li>
</ul>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-c"><code v-pre class="language-c">int *foo () 
{
		int val;
		return &amp;val;
}</code></pre>
</doc-codeblock></div>
<doc-anchor-target id="freeing-blocks-multiple-times">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#freeing-blocks-multiple-times">#</doc-anchor-trigger>
        <span>Freeing Blocks Multiple Times</span>
    </h2>
</doc-anchor-target>
<ul>
<li>Nasty!</li>
</ul>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-c"><code v-pre class="language-c">x = malloc(N*sizeof(int));
// &lt;manipulate x&gt;
free(x);

y = malloc(M*sizeof(int));
// &lt;manipulate y&gt;
free(x);</code></pre>
</doc-codeblock></div>
<doc-anchor-target id="referencing-freed-blocks">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#referencing-freed-blocks">#</doc-anchor-trigger>
        <span>Referencing Freed Blocks</span>
    </h2>
</doc-anchor-target>
<ul>
<li>Evil!</li>
</ul>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-c"><code v-pre class="language-c">x = malloc(Nsizeof(int));
// &lt;manipulate x&gt; 
free(x);
... 

y = malloc(Msizeof(int));
for (i = 0; i &lt; M; i++)
    y[i] = x[i]++;</code></pre>
</doc-codeblock></div>
<doc-anchor-target id="failing-to-free-blocks-memory-leaks">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#failing-to-free-blocks-memory-leaks">#</doc-anchor-trigger>
        <span>Failing to Free Blocks (Memory Leaks)</span>
    </h2>
</doc-anchor-target>
<ul>
<li>Slow, long-term killer!</li>
</ul>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-c"><code v-pre class="language-c">foo()
{
    int x = malloc(Nsizeof(int));
    ... return;
}</code></pre>
</doc-codeblock></div>
<ul>
<li>Freeing only part of a data structure</li>
</ul>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-c"><code v-pre class="language-c">struct list
{
    int val;
    struct list *next;
};

foo()
{
    struct list *head = malloc(sizeof(struct list));
    head-&gt;val = 0;
    head-&gt;next = NULL;
   // &lt;create and manipulate the rest of the list&gt;
... free(head);
    return;
}</code></pre>
</doc-codeblock></div>
<doc-anchor-target id="dealing-with-memory-bugs">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#dealing-with-memory-bugs">#</doc-anchor-trigger>
        <span>Dealing With Memory Bugs</span>
    </h2>
</doc-anchor-target>
<ul>
<li>Debugger:gdb
<ul>
<li>Good for finding bad pointer dereferences § Hard to detect the other memory bugs</li>
</ul>
</li>
<li>Data structure consistency checker
<ul>
<li>Runs silently, prints message only on error § Use as a probe to zero in on error</li>
</ul>
</li>
<li>Binary translator: valgrind
<ul>
<li>Powerful debugging and analysis technique</li>
<li>Rewrites text section of executable object file</li>
<li>Checks each individual reference at runtime</li>
<li>Bad pointers, overwrites, refs outside of allocated block</li>
</ul>
</li>
<li>glibc malloc contains checking code
<ul>
<li><code v-pre>setenv MALLOC_CHECK_ 3</code></li>
</ul>
</li>
</ul>

                                
                                <!-- Required only on API pages -->
                                <doc-toolbar-member-filter-no-results />
                            </div>
                            <footer class="clear-both">
                            
                                <nav class="flex mt-14">
                                    <div class="w-1/2">
                                        <a class="px-5 py-4 h-full flex items-center break-normal font-medium text-blue-500 dark:text-blue-400 border border-gray-300 hover:border-gray-400 dark:border-dark-650 dark:hover:border-dark-450 rounded-l-lg transition-colors duration-150 relative hover:z-5" href="../../sp/10-dynamic-memory-allocation-basic-concepts-6f95f4988f6040b9a8d8c70024ae2817/">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="mr-3" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" overflow="visible"><path d="M19 11H7.41l5.29-5.29a.996.996 0 10-1.41-1.41l-7 7a1 1 0 000 1.42l7 7a1.024 1.024 0 001.42-.01.996.996 0 000-1.41L7.41 13H19c.55 0 1-.45 1-1s-.45-1-1-1z" /><path fill="none" d="M0 0h24v24H0z" /></svg>
                                            <span>
                                                <span class="block text-xs font-normal text-gray-400 dark:text-dark-400">Previous</span>
                                                <span class="block mt-1">10. Dynamic Memory Allocation: Basic Concepts</span>
                                            </span>
                                        </a>
                                    </div>
                            
                                    <div class="w-1/2">
                                        <a class="px-5 py-4 -mx-px h-full flex items-center justify-end break-normal font-medium text-blue-500 dark:text-blue-400 border border-gray-300 hover:border-gray-400 dark:border-dark-650 dark:hover:border-dark-450 rounded-r-lg transition-colors duration-150 relative hover:z-5" href="../../sp/12-linking-153b2a5f6c5f4fec9bb0a9ef3ba14036/">
                                            <span>
                                                <span class="block text-xs font-normal text-right text-gray-400 dark:text-dark-400">Next</span>
                                                <span class="block mt-1">12. Linking</span>
                                            </span>
                                            <svg xmlns="http://www.w3.org/2000/svg" class="ml-3" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" overflow="visible"><path d="M19.92 12.38a1 1 0 00-.22-1.09l-7-7a.996.996 0 10-1.41 1.41l5.3 5.3H5c-.55 0-1 .45-1 1s.45 1 1 1h11.59l-5.29 5.29a.996.996 0 000 1.41c.19.2.44.3.7.3s.51-.1.71-.29l7-7c.09-.09.16-.21.21-.33z" /><path fill="none" d="M0 0h24v24H0z" /></svg>
                                        </a>
                                    </div>
                                </nav>
                            </footer>
                        </main>
                
                        <div class="border-t dark:border-dark-650 pt-6 mb-8">
                            <footer class="flex flex-wrap items-center justify-between">
                                <div>
                                    <ul class="flex flex-wrap items-center text-sm">
                                    </ul>
                                </div>
                                <div class="docs-copyright py-2 text-gray-500 dark:text-dark-350 text-sm leading-relaxed"><p>© Copyright 2020 - 2022 KyuHwan Shim, All rights reserved.</p></div>
                            </footer>
                        </div>
                    </div>
                
                    <!-- Rendered if sidebar right is enabled -->
                    <!-- Sidebar right skeleton-->
                    <div v-cloak class="fixed top-0 bottom-0 right-0 translate-x-full bg-white border-gray-200 lg:sticky lg:border-l lg:shrink-0 lg:pt-6 lg:transform-none sm:w-1/2 lg:w-64 lg:z-0 md:w-104 sidebar-right skeleton dark:bg-dark-850 dark:border-dark-650">
                        <div class="pl-5">
                            <div class="w-32 h-3 mb-4 bg-gray-200 dark:bg-dark-600 rounded-full loading"></div>
                            <div class="w-48 h-3 mb-4 bg-gray-200 dark:bg-dark-600 rounded-full loading"></div>
                            <div class="w-40 h-3 mb-4 bg-gray-200 dark:bg-dark-600 rounded-full loading"></div>
                        </div>
                    </div>
                
                    <!-- User should be able to hide sidebar right -->
                    <doc-sidebar-right v-cloak></doc-sidebar-right>
                </div>

            </div>
        </div>
    
        <doc-search-mobile></doc-search-mobile>
        <doc-back-to-top></doc-back-to-top>
    </div>


    <div id="docs-overlay-target"></div>

    <script>window.__DOCS__ = { "title": "11. Dynamic Memory Allocation: Advanced Concepts", level: 2, icon: "file", hasPrism: true, hasMermaid: false, hasMath: false }</script>
</body>
</html>
